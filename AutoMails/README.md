# EMAILAPP脚本说明

## 缘由

对现在的工作来说，每周都要发送大量邮件，而且这些邮件都是定期通报类型的内容，基本不会有大幅度的改变，所以各位领导关注的点就到了邮件标题、抄送人员全不全等这类问题上了。尤其是在有一次把标题写错了之后，更是深深觉得人力难免有穷时，还是写成程序来的简单自如，自动化办公无外乎如是。

而且作为一个数据科学从业者，这也算是个无奈的动作。所以就有了这个Python脚本。虽然我这就是一个重复造轮子的事情，但是，市面上的email python脚本都不太令人满意。最大的不满意就是很多都只为了学习smtplib，而不是真的要弄得好用。虽然我重复造的这个轮子也就那么回事，但是我自己用的爽快异常啊~~

## 脚本主要内容介绍

脚本主要基于TOML语言定制配置，同时也基于TOML构建EMAIL内容。当然，所有脚本内容都是Python写的。依赖如下库（/模块）：

- toml
- argparse
- smtplib
- email

对各个库文件的需求我就不一一说明了，想详细搞清楚的可以直接看脚本就好了，我也有详细注释。这里主要说明脚本参数、邮件格式与附件添加模式等

### 脚本参数说明

为了增加脚本的自由度，或者说，让这个脚本更接近邮件发送软件的状态，必然需要使用一些参数增加自由度。主要参数有：

- mail 参数
- type 参数

#### 参数MAIL

这个参数主要用来把邮件主体传入到脚本中，其中包含了接收人、抄送、附件、邮件正文、邮件格式、图片等等内容。并且这个主体必须是TOML格式的。详细的MAIL格式为：

```toml
# to与content是必须包含的内容，cc、bcc是可选的。
# 子键值name是可选的。
# 邮件语言 language 的选择需要与配置文件中的user.name下的子键保持一直，如果不一致，虽然不会报错，但会以罗列顺序的第一个作为user的名字使用。
language = 'zh'
[to]
	addr = ['邮箱地址']
	name = ['收件人名称']
[cc]
	addr = ['抄送邮箱地址']
	name = ['抄送人名称']
[bcc]
	addr = ['抄送邮箱地址']
	name = ['抄送人名称']
[content]
	title = '邮件标题'
	text = '邮件正文'
	type = 'html/plain'
    tail = '签名信息（type/内容）'
# 以下除了主标题不可更改，子键名可按需更改，或增加内容
[appendix]
	part1 = '本地文件位置'
	part2 = '本地文件位置'
[image]
	img1 = '本地文件位置'
	img2 = '本地文件位置'
```

mail参数文件的说明如上示例所言，最重要的是to和content两个部分。其他多数均为可选项目。

其中收件人（to）和抄送人（cc）都可以是多个人组成，需要对应好名字和邮箱的关系就可以。对于密件抄送，

#### 参数TYPE

TYPE参数是用来决定使用哪个配置文件中的email地址来发送邮件。本来想把这个type参数也整合到传入mail参数的toml文件里的，但是我在使用中觉得，type不是每次都需要选择，写道mail文件中解析的时候要多写几行代码，所以，就坚持了type作为参数的原决定。但是type这个参数是个可选参数，当不适用的时候，默认选则第一个类型。

type参数的值，主要依赖于配置文件中写入了那几个邮箱。默认不填写这个参数的话，就是用配置中的第一个邮箱来发邮件。

### 配置文件说明

现在就来说配置文件。一样是TOML语言文件。主要配置的就是Email SMTP服务器的情况，同时，默认使用SSL连接，对于TLS模式以后有时间我再写吧……

另外就是，不支持gmail……谁让gmail需要使用google api呢……所以，等我哪天更闲一些的时候再考虑更新好了……暂时还是别想了啊……捂脸……

配置文件格式：

```toml
[user.name]
    zh = "中文名字"
    en = "Name in English"

[email.work]
    addr = "xxx@company.com"
    host = "smtp.company.com"
    port = 123
    password = "password"
    tail = ["file","tail.html"]

[email.person]
    addr = "user@user.com"
    host = "smtp.user.com"
    port = 456
    password = "password"
    tail = ["txt","Sidney Zhang"]
```

配置文件主要需要配置的其实就是smtp服务器……其他都还好，email的子键在上面的示例中有两个，分别是work和person，当然也可以有更多，只是需要主键都是email就可以。

配置文件的最小保留关键词是：user、name、email、addr、host、port、password、tail、txt、file。

### 签名的使用说明

这个邮件脚本有两种添加签名的方式，一种是跟随邮箱使用的签名，只要选择这个邮箱发邮件，就自带这个邮件签名。另一种方式，是在邮件本体内添加的签名。这个签名的优先级更高，只要邮件本体有添加签名，则会按照邮件本体的签名来生成邮件。

配置文件中的签名，是个文本对，且仅支持两种方式，一种file添加方式，一种为txt方式。在配置文件中的添加签名的结构均为: [类型，目标]。其中：

    - file类型的目标可以为任意文本格式，只要python可以读取就可以；
    - txt类型目标即为签名文字。

在邮件主体文本中添加的签名，一样是两种类型，file类型和txt类型。不过写的格式略有不同，是一个字符串：“type/......”。其中：
    
    - type，就是txt或者file，只要不是file其他都被认为是txt类型。
    - ......，就是表示对应文本，file的时候是可读取的文件，其他时候就是字符串。

其中只要签名档使用的是html文件，那么，所有email构建模式都将使用html，无论邮件主题中所声明的type类型是什么，都将打上div标签转换为html格式。

当然这么来操作，也是为了方便而已，减少错误的发生概率。

## 其他说明

当前脚本版本为： 1.0.0
